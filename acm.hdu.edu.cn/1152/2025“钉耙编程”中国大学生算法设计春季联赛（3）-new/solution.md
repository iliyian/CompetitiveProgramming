## P1001 数组计数

由 $Lucas$ 定理，有：
$$
\tbinom{x}{y}\equiv\tbinom{\lfloor x/2\rfloor}{\lfloor y/2\rfloor}\tbinom{x\%2}{y\%2}\mod2.
$$
对于 $\tbinom{x\%2}{y\%2}$ 只有四种情况，其中只有 $\tbinom{0}{1}=0$ ，也就是说只有这种情况会导致 $\tbinom{x}{y}\%2=0$，进而致使该种情况不合法。

则问题转化为：对 $a_i$ 进行二进制拆分，只有 $a_i$ 中为0的位 $b_i$ 不能取 1，求满足情况的$\{b_i\}$ 数量。

对于每一个 $a_i$ 分别求出合法的 $b_i$ 数量，最终相乘即可得到答案。



## P1002 宾果游戏

考虑 $\min-\max$ 容斥：
$$
\min_{x\in S}\{x\}=\sum_{T\subseteq S,T\neq \phi}(-1)^{|T|-1}\max_{x\in T}\{x\}
$$
这个式子在期望意义下同样成立：
$$
E(\min_{x\in S}\{x\}) = \sum\limits_{T \subseteq S,T\neq\phi} (-1)^{|T| - 1} E(\max_{x\in T}\{x\})
$$
令 $rc$ 表示一行 / 列，$f(rc)$ 表示该行 / 列，被完全点亮需要的轮数， $S$ 表示所有的行 + 列的集合，$S'$ 为所有未被污染的行 + 列的集合。

那么有：
$$
\begin{aligned}
ans&=E(\min_{rc\in S}\{f(rc)\})\\
&=E(\min_{rc\in S'}\{f(rc)\})\\
&=\sum_{T\subseteq S',T\neq\phi}(-1)^{|T|-1}E(\max_{rc\in T}\{f(rc)\})\\
\end{aligned}
$$
$E(\max_{rc\in T}\{f(rc)\}$ 为将行 + 列的集合 $T$ 完全点亮的期望次数，令 $cnt[T]$ 为行 + 列的集合 $T$ 占据的总格数。问题转化为求在 $n\times m$ 个格子中，点亮特定的 $cnt[T]$ 个格子的期望轮数。

记 $g(N,x)$ 为在 $N$ 个格子中，点亮特定的 $x$ 个格子的期望轮数。

我们有：
$$
\begin{aligned}
g(N,x)&=1+\frac{x}{N}g(N,x-1)+\frac{N-x}{N}g(N,x)\\
\frac{x}{N}g(N,x)&=1+\frac{x}{N}g(N,x-1)\\
g(N,x)&=\frac{N}{x}+g(N,x-1)\\
g(N,x)&=\sum_{i=1}^x\frac{N}{i}
\end{aligned}
$$
最终得到：
$$
\begin{aligned}
ans=\sum_{T\subseteq S',T\neq\phi}(-1)^{|T|-1}g(n\times m,cnt[T])
\end{aligned}
$$
将 $g(n\times m,i)$ 预处理出来，即可通过本题。



## P1003 拼尽全力

我们可以将可以面试的公司放入一个队列中，并且每次增加新的能力要求。同时，我们需要维护一个记录，对于第 $i$ 个公司，有多少个能力不达标。我们可以使用 $m$ 维的优先队列，每次能力更新后，从最小值开始判断是否有满足条件的公司。当每个能力都达标后，将公司加入到可以面试的队列中。

因为最多每个公司的每个能力都放在优先队列里，复杂度为 $O(nmlogm)$



## P1004 弯曲筷子

我们发现，要选择的筷子一定只可能和弯曲程度相邻的筷子组成一双，这样的不舒适度最小。有种特殊情况，如果两支要选的筷子中间隔着一支筷子，这两支也可能组成一双。

把筷子排序后，我们设 $dp_{i,1/0}$​ 代表遍历到第 $i$ 支筷子是否取，同时我们保证 $[1,i)$ 要取的筷子都取了。那么转移方程为： 

若第 $i - 1$ 支筷子要选 
$$
dp_{i, 0} = dp_{i - 1, 1}  \\
dp_{i, 1} = dp_{i - 1, 0} + (c_i - c_{i - 1}) ^ 2
$$

若第 $i - 1$ 支筷子不选 
$$
dp_{i, 0} = min(dp_{i - 1, 0}, dp_{i - 1, 1})  \\
dp_{i, 1} = min(dp_{i - 1, 0} + (c_i - c_{i - 1}) ^ 2, dp_{i - 2, 0} + (c_i - c_{i - 2}) ^ 2)
$$

即，讨论是否隔着一支筷子选。最后答案就是 $dp_{n,1}$ 或，不必须选第n个筷子的$dp_{n,0}$ 。 复杂度为 $ O(n) $。



## P1005 修复公路

由于这些边是双向的，我们可以通过并查集将所有能够相互传送的节点连接在一起。不连通的块一定是相邻的。因此，修建道路的最小数量等于连通块的个数减一，这就是最终的答案。复杂度 $O(\alpha(n))$



## P1006 最小划分

我们可以看做用 $S$ 的子串覆盖 $t$ ，问最少要覆盖多少次。 显然，每次覆盖的越长越好。因为若 $wA$ 是 $S$ 的子串，则 $A$ 一定是 $S$ 的子串。所以上一段能覆盖 $w$ 的话一定更优。

我们用，SA 的 $height$ 数组求出 $T$ 的每个后缀和 $S$ 的子串中的最长公共前缀是多少。 然后用倍增的思想，求出从 $T_i$ 开始，覆盖 $2^j$ 段，最远能覆盖到哪。类似于 ST 表。每次询问找到最小的能覆盖完的段数即可。复杂度 $O(nlogn)$



## P1007 宝石商店

首先可以发现魔法公式其实就是异或。

如果每次询问都是前缀的话，那么是一个经典的 Trie 树能解决的问题。

因为 Trie 树上维护的信息具有可减性，所以可以模仿主席树一样写出 Copy-on-write Trie 即可解决本问题。



## P1008 序列期望

考虑计算所有区间的不同的数的个数，若区间的数都不相同，总共的方案是 $\frac{len\times(len+1)}2$，总的贡献是$\frac{len\times(len+1)\times(len+2)}{6}$。

考虑容斥，对于询问区间 $[l,r]$ 内相邻的两个相同数，假设他们出现的位置为 $last$ 和 $x$，他们对答案的贡献为 $-(last-l+1)\times(r-x+1)$，把括号拆出来，分别维护常数项， $l,r,l\times r$ 前面的系数，将询问离线扫一遍右端点即可计算答案。



## P1009 部落冲突

如果没有 3 操作，那么可以用 std::set 启发式合并或者并查集来解决问题。

其实可以将 3 操作看作一个独立的问题，即单独写一个**评测机**和**你的程序**之间**编号**的转接桥。因为本质上，部落的编号只是一个标签，我们在交换的时候不必真的挨个交换每个野蛮人，只用交换部落编号这个标签即可。

具体来说，你应该维护**评测机以为的编号**和**你真正的编号**之间的双向映射。**评测机**让你进行交换两个部落的时候，只需要修改这个映射关系。



## P1010 选择配送

切比雪夫距离定义如下：

设 $A(x_1,y_1),B(x_2,y_2)$

$d(A,B)=\max\{|x_1-x_2|,|y_1-y_2|\}$

曼哈顿距离与切比雪夫距离可以相互转化：

$\begin{aligned}D_{man}(A,B)&=|x_1-x_2|+|y_1-y_2|\\&=\max\{x_1-x_2+y_1-y_2,x_1-x_2+y_2-y_1,x_2-x_1+y_1-y_2,x_2-x_1+y_2-y_1\}\\&=\max\{|(x_1+y_1)-(x_2+y_2)|,|(x_1-y_1)-(x_2-y_2)|\}\\&=d((x_1+y_1,x_1-y_1),(x_2+y_2,x_2-y_2))\end{aligned}$

令 $A'(x_1+y_1,x_1-y_1),B'(x_2+y_2,x_2-y_2)$

将曼哈顿距离转为切比雪夫距离后，$A',B'$ 的 x，y 坐标就相互独立了。

求出转化后客户最小和最大的 x 坐标和 y 坐标。

对于每个配送站算一下他们距离最小和最大的 x / y 的距离，取个max就是这个配送站距离最远的客户的距离。

对于所有配送站取个最小值就可以了。

